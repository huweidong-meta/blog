# 笔记二
## Large pages and Java
我最近花了很多时间在 JVM 的内存预留代码上。之所以开始，是因为我们得到了外部贡献，以使 Linux 能够使用多个大页面大小。为了以一种好的方式做到这一点，必须首先重构一些其他的东西。在沿着内存通道进行这次旅行时，我意识到做一个关于 JVM 使用多大页面的简短摘要可能是一个有趣的阅读。

## Introduction to large pages
在我们开始讨论 JVM 如何使用它们之前，让我们先简单介绍一下什么是大页面。

大页面，或者有时是大页面，是一种减少处理器 TLB 缓存压力的技术。这些缓存用于加快将虚拟地址转换为物理内存地址的时间。大多数体系结构支持多种页面大小，通常具有 4 KB 的基本页面大小。对于使用大量内存的应用程序，例如大型 Java 堆，将内存映射为更大的页面粒度以增加 TLB 命中的机会是有意义的。在 x86-64 上，2 MB 和 1 GB 页面可用于此目的，对于内存密集型工作负载，这可能会产生非常大的影响。

在上面的图表中，我们可以看到在几个 SPECjbb®1 基准测试中使用和不使用大页面运行的差异。配置的唯一区别是高性能 JVM 启用了大页面。结果非常令人印象深刻，对于许多支持大页面的 Java 工作负载来说，这是一个巨大的胜利。

## Enabling large pages
为 Java 启用大页面的通用开关是 -XX:+UseLargePages，但要利用大页面，操作系统也需要正确配置。让我们看看如何在 Linux 和 Windows 上做到这一点。

### Linux
在 Linux 上，JVM 可以通过两种不同的方式使用大页面：透明大页面和 HugeTLB 页面。它们在配置方式上有所不同，但在性能特征上也有所不同。

### Transparent Huge Pages
透明大页面，或简称 THP，是一种在 Linux 中简化大页面使用和启用的方法。启用后，Linux 内核将尝试使用大页面来进行足够大且有资格使用 THP 的保留。 THP 支持可以在三个不同的级别进行配置：
